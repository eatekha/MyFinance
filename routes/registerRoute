async function checkUserExists(pool, user_name) {
  const query = {
    text: 'SELECT * FROM users WHERE user_name = $1',
    values: [user_name],
  };

  const { rowCount } = await pool.query(query);
  return rowCount > 0;
}

function registerUser(pool) {
  return async function (req, res) {
    const { user_name, user_password } = req.body;

    try {
      const userExists = await checkUserExists(pool, user_name);
      if (userExists) {
        return res.status(400).json({ error: 'User already registered' });
      }

      // Insert user data into the database
      await pool.query('INSERT INTO users (user_name, user_password) VALUES ($1, $2)', [user_name, user_password]);

      return res.status(200).json({ message: 'User registered successfully' });
    } catch (error) {
      console.error(error);
      return res.status(500).json({ error: 'An error occurred' });
    }
  };
}

module.exports = registerUser;
